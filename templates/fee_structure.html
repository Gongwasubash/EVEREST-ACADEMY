{% extends 'base.html' %}

{% block title %}Fee Structure - School Management{% endblock %}

{% block extra_css %}
<style>
    .save-btn {
        margin-bottom: 20px;
        padding: 10px 20px;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
    }
    .save-btn:hover {
        background: #45a049;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
    }
    th {
        background-color: #4CAF50;
        color: white;
        font-weight: bold;
        font-size: 12px;
    }
    tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    tr:hover {
        background-color: #f5f5f5;
    }
    input {
        border: none;
        background: transparent;
        text-align: center;
        width: 100%;
        font-weight: bold;
        color: #2c5aa0;
        font-size: 12px;
    }
    input:focus {
        outline: 2px solid #4CAF50;
        background: #fff;
    }
    input[readonly] {
        color: #333;
        font-weight: bold;
    }
</style>
{% endblock %}

{% block content %}
<h1>Fee Structure</h1>
        <button onclick="saveFeeStructure()" class="save-btn">Save Fee Structure</button>
        
        <form id="feeForm">
            {% csrf_token %}
            <table>
                <thead>
                    <tr>
                        <th>Class</th>
                        <th>Admission Fee</th>
                        <th>Monthly Fee</th>
                        <th>Tuition Fee</th>
                        <th>Examination Fee</th>
                        <th>Library Fee</th>
                        <th>Sports Fee</th>
                        <th>Laboratory Fee</th>
                        <th>Computer Fee</th>
                        <th>Transportation Fee</th>

                    </tr>
                </thead>
                <tbody>
                    {% for fee in fee_structures %}
                    <tr>
                        <td><input type="text" name="class_name" value="{{ fee.class_name }}" readonly></td>
                        <td><input type="number" name="admission_fee" value="{{ fee.admission_fee }}"></td>
                        <td><input type="number" name="monthly_fee" value="{{ fee.monthly_fee }}"></td>
                        <td><input type="number" name="tuition_fee" value="{{ fee.tuition_fee }}"></td>
                        <td><input type="number" name="examination_fee" value="{{ fee.examination_fee }}"></td>
                        <td><input type="number" name="library_fee" value="{{ fee.library_fee }}"></td>
                        <td><input type="number" name="sports_fee" value="{{ fee.sports_fee }}"></td>
                        <td><input type="number" name="laboratory_fee" value="{{ fee.laboratory_fee }}"></td>
                        <td><input type="number" name="computer_fee" value="{{ fee.computer_fee }}"></td>
                        <td><input type="number" name="transportation_fee" value="{{ fee.transportation_fee }}"></td>

                    </tr>
                    {% empty %}
                    <tr>
                        <td><input type="text" name="class_name" value="Nursery" readonly></td>
                        <td><input type="number" name="admission_fee" value="5000"></td>
                        <td><input type="number" name="monthly_fee" value="2500"></td>
                        <td><input type="number" name="tuition_fee" value="2000"></td>
                        <td><input type="number" name="examination_fee" value="500"></td>
                        <td><input type="number" name="library_fee" value="200"></td>
                        <td><input type="number" name="sports_fee" value="300"></td>
                        <td><input type="number" name="laboratory_fee" value="0"></td>
                        <td><input type="number" name="computer_fee" value="0"></td>
                        <td><input type="number" name="transportation_fee" value="1200"></td>

                    </tr>
                    <tr>
                        <td><input type="text" name="class_name" value="LKG" readonly></td>
                        <td><input type="number" name="admission_fee" value="5200"></td>
                        <td><input type="number" name="monthly_fee" value="2700"></td>
                        <td><input type="number" name="tuition_fee" value="2200"></td>
                        <td><input type="number" name="examination_fee" value="500"></td>
                        <td><input type="number" name="library_fee" value="200"></td>
                        <td><input type="number" name="sports_fee" value="300"></td>
                        <td><input type="number" name="laboratory_fee" value="0"></td>
                        <td><input type="number" name="computer_fee" value="0"></td>
                        <td><input type="number" name="transportation_fee" value="1200"></td>

                    </tr>
                    <tr>
                        <td><input type="text" name="class_name" value="UKG" readonly></td>
                        <td><input type="number" name="admission_fee" value="5400"></td>
                        <td><input type="number" name="monthly_fee" value="2900"></td>
                        <td><input type="number" name="tuition_fee" value="2400"></td>
                        <td><input type="number" name="examination_fee" value="500"></td>
                        <td><input type="number" name="library_fee" value="200"></td>
                        <td><input type="number" name="sports_fee" value="300"></td>
                        <td><input type="number" name="laboratory_fee" value="0"></td>
                        <td><input type="number" name="computer_fee" value="200"></td>
                        <td><input type="number" name="transportation_fee" value="1200"></td>

                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </form>
{% endblock %}

{% block extra_js %}
<script>
function saveFeeStructure() {
    const form = document.getElementById('feeForm');
    const formData = new FormData(form);
    
    fetch('/fees/', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Fee structure saved successfully!');
            location.reload();
        } else {
            alert('Error: ' + (data.error || 'Unknown error'));
        }
    })
    .catch(error => {
        alert('Error: ' + error.message);
    });
}
</script>
{% endblock %}