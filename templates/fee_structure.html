{% extends "base.html" %}

{% block title %}Fee Structure - School Management{% endblock %}

{% block extra_css %}
<style>
    .save-btn {
        margin-bottom: 20px;
        padding: 10px 20px;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
    }
    .save-btn:hover {
        background: #45a049;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
    }
    th {
        background-color: #4CAF50;
        color: white;
        font-weight: bold;
        font-size: 12px;
    }
    tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    tr:hover {
        background-color: #f5f5f5;
    }
    input {
        border: none;
        background: transparent;
        text-align: center;
        width: 100%;
        font-weight: bold;
        color: #2c5aa0;
        font-size: 12px;
    }
    input:focus {
        outline: 2px solid #4CAF50;
        background: #fff;
    }
    input[readonly] {
        color: #333;
        font-weight: bold;
    }
</style>
{% endblock %}

{% block content %}
<h1>Fee Structure</h1>
        <button onclick="saveFeeStructure()" class="save-btn">Save Fee Structure</button>
        
        <form id="feeForm">
            {% csrf_token %}
            <table>
                <thead>
                    <tr>
                        <th>Class</th>
                        <th>Admission Fee</th>
                        <th>Monthly Fee</th>
                        <th>Tuition Fee</th>
                        <th>Examination Fee</th>
                        <th>Library Fee</th>
                        <th>Sports Fee</th>
                        <th>Laboratory Fee</th>
                        <th>Computer Fee</th>
                        <th>Transportation Fee</th>

                    </tr>
                </thead>
                <tbody>
                    {% for fee in fee_structures %}
                    <tr>
                        <td><input type="text" name="class_name" value="{{ fee.class_name }}" readonly></td>
                        <td><input type="number" name="admission_fee" value="{{ fee.admission_fee }}"></td>
                        <td><input type="number" name="monthly_fee" value="{{ fee.monthly_fee }}"></td>
                        <td><input type="number" name="tuition_fee" value="{{ fee.tuition_fee }}"></td>
                        <td><input type="number" name="examination_fee" value="{{ fee.examination_fee }}"></td>
                        <td><input type="number" name="library_fee" value="{{ fee.library_fee }}"></td>
                        <td><input type="number" name="sports_fee" value="{{ fee.sports_fee }}"></td>
                        <td><input type="number" name="laboratory_fee" value="{{ fee.laboratory_fee }}"></td>
                        <td><input type="number" name="computer_fee" value="{{ fee.computer_fee }}"></td>
                        <td><input type="number" name="transportation_fee" value="{{ fee.transportation_fee }}"></td>
                    </tr>
                    {% empty %}
                    {% for class_num in "12345678910"|make_list %}
                    <tr>
                        <td><input type="text" name="class_name" value="{{ class_num }}" readonly></td>
                        <td><input type="number" name="admission_fee" value="{% if class_num == '1' %}5000{% elif class_num == '2' %}5200{% elif class_num == '3' %}5400{% elif class_num == '4' %}5600{% elif class_num == '5' %}5800{% elif class_num == '6' %}6000{% elif class_num == '7' %}6200{% elif class_num == '8' %}6400{% elif class_num == '9' %}6600{% else %}6800{% endif %}"></td>
                        <td><input type="number" name="monthly_fee" value="{% if class_num == '1' %}2500{% elif class_num == '2' %}2700{% elif class_num == '3' %}2900{% elif class_num == '4' %}3100{% elif class_num == '5' %}3300{% elif class_num == '6' %}3500{% elif class_num == '7' %}3700{% elif class_num == '8' %}3900{% elif class_num == '9' %}4100{% else %}4300{% endif %}"></td>
                        <td><input type="number" name="tuition_fee" value="{% if class_num == '1' %}2000{% elif class_num == '2' %}2200{% elif class_num == '3' %}2400{% elif class_num == '4' %}2600{% elif class_num == '5' %}2800{% elif class_num == '6' %}3000{% elif class_num == '7' %}3200{% elif class_num == '8' %}3400{% elif class_num == '9' %}3600{% else %}3800{% endif %}"></td>
                        <td><input type="number" name="examination_fee" value="500"></td>
                        <td><input type="number" name="library_fee" value="200"></td>
                        <td><input type="number" name="sports_fee" value="300"></td>
                        <td><input type="number" name="laboratory_fee" value="{% if class_num|add:0 >= 6 %}500{% else %}0{% endif %}"></td>
                        <td><input type="number" name="computer_fee" value="{% if class_num|add:0 >= 3 %}200{% else %}0{% endif %}"></td>
                        <td><input type="number" name="transportation_fee" value="1200"></td>
                    </tr>
                    {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        </form>
{% endblock %}

{% block extra_js %}
<script>
function saveFeeStructure() {
    const form = document.getElementById('feeForm');
    const formData = new FormData(form);
    
    fetch('/fees/', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Fee structure saved successfully!');
            location.reload();
        } else {
            alert('Error: ' + (data.error || 'Unknown error'));
        }
    })
    .catch(error => {
        alert('Error: ' + error.message);
    });
}
</script>
{% endblock %}