{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>{% block title %}School Management{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/dashboard-sidebar-fix.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    {% block extra_css %}{% endblock %}
</head>
<body>
    <div class="layout">
        <aside class="sidebar">
            <div class="sidebar-header" onclick="openSchoolSettingsPopup()" style="cursor: pointer;">
                <img src="{% if school_info.logo %}{{ school_info.logo.url }}{% else %}{% static 'img/Everest-Crest-Square.png' %}{% endif %}" alt="{{ school_info.school_name }}" style="width: 60px; height: 60px; object-fit: contain;">
                <h2 style="font-size: 14px; margin-top: 5px;">{{ school_info.school_name }}</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="{% url 'dashboard' %}" class="nav-item{% if request.resolver_match.url_name == 'dashboard' or request.resolver_match.url_name == 'home' %} active{% endif %}">
                    <span class="nav-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"/>
                        </svg>
                    </span>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="{% url 'students' %}" class="nav-item{% if request.resolver_match.url_name == 'students' %} active{% endif %}">
                    <span class="nav-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16 4C16 2.9 15.1 2 14 2H10C8.9 2 8 2.9 8 4H5C3.9 4 3 4.9 3 6V20C3 21.1 3.9 22 5 22H19C20.1 22 21 21.1 21 20V6C21 4.9 20.1 4 19 4H16M10 4H14V6H10V4M7 8H17V10H7V8M7 12H17V14H7V12M7 16H14V18H7V16Z"/>
                        </svg>
                    </span>
                    <span class="nav-text">Students</span>
                </a>

                <a href="{% url 'reports' %}" class="nav-item{% if request.resolver_match.url_name == 'reports' %} active{% endif %}">
                    <span class="nav-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M22,21H2V3H4V19H6V10H10V19H12V6H16V19H18V14H22V21Z"/>
                        </svg>
                    </span>
                    <span class="nav-text">Reports</span>
                </a>
                <a href="{% url 'marksheet_system' %}" class="nav-item{% if request.resolver_match.url_name == 'marksheet_system' %} active{% endif %}">
                    <span class="nav-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M9,13V15H7V13H9M11,13H17V15H11V13M9,16V18H7V16H9M11,16H17V18H11V16Z"/>
                        </svg>
                    </span>
                    <span class="nav-text">Marksheet</span>
                </a>
                <a href="{% url 'fees' %}" class="nav-item{% if request.resolver_match.url_name == 'fees' %} active{% endif %}">
                    <span class="nav-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7,15H9C9,16.08 10.37,17 12,17C13.63,17 15,16.08 15,15C15,13.9 13.96,13.5 11.76,12.97C9.64,12.44 7,11.78 7,9C7,7.21 8.47,5.69 10.5,5.18V3H13.5V5.18C15.53,5.69 17,7.21 17,9H15C15,7.92 13.63,7 12,7C10.37,7 9,7.92 9,9C9,10.1 10.04,10.5 12.24,11.03C14.36,11.56 17,12.22 17,15C17,16.79 15.53,18.31 13.5,18.82V21H10.5V18.82C8.47,18.31 7,16.79 7,15Z"/>
                        </svg>
                    </span>
                    <span class="nav-text">Fee Structure</span>
                </a>


                <a href="{% url 'fee_receipt_book' %}" class="nav-item{% if request.resolver_match.url_name == 'fee_receipt_book' %} active{% endif %}">
                    <span class="nav-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,19H5V5H19V19Z"/>
                        </svg>
                    </span>
                    <span class="nav-text">Fee Receipt</span>
                </a>
                <a href="{% url 'student_daily_exp' %}" class="nav-item{% if request.resolver_match.url_name == 'student_daily_exp' %} active{% endif %}">
                    <span class="nav-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12,1L21,5V11C21,16.55 17.16,21.74 12,23C6.84,21.74 3,16.55 3,11V5L12,1M12,7C10.9,7 10,7.9 10,9S10.9,11 12,11C13.1,11 14,10.1 14,9S13.1,7 12,7M18,14C18,16.21 15.79,18 13,18H11C8.21,18 6,16.21 6,14C6,13.45 6.45,13 7,13S8,13.45 8,14C8,15.1 8.9,16 10,16H14C15.1,16 16,15.1 16,14C16,13.45 16.45,13 17,13S18,13.45 18,14Z"/>
                        </svg>
                    </span>
                    <span class="nav-text">Daily Expenses</span>
                </a>

                <a href="{% url 'school_settings' %}" class="nav-item{% if request.resolver_match.url_name == 'school_settings' %} active{% endif %}">
                    <span class="nav-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
                        </svg>
                    </span>
                    <span class="nav-text">School Settings</span>
                </a>

                <a href="{% url 'website_settings' %}" class="nav-item{% if request.resolver_match.url_name == 'website_settings' %} active{% endif %}">
                    <span class="nav-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16.36,14C16.44,13.34 16.5,12.68 16.5,12C16.5,11.32 16.44,10.66 16.36,10H19.74C19.9,10.64 20,11.31 20,12C20,12.69 19.9,13.36 19.74,14M14.59,19.56C15.19,18.45 15.65,17.25 15.97,16H18.92C17.96,17.65 16.43,18.93 14.59,19.56M14.34,14H9.66C9.56,13.34 9.5,12.68 9.5,12C9.5,11.32 9.56,10.65 9.66,10H14.34C14.43,10.65 14.5,11.32 14.5,12C14.5,12.68 14.43,13.34 14.34,14M12,19.96C11.17,18.76 10.5,17.43 10.09,16H13.91C13.5,17.43 12.83,18.76 12,19.96M8,8H5.08C6.03,6.34 7.57,5.06 9.4,4.44C8.8,5.55 8.35,6.75 8,8M5.08,16H8C8.35,17.25 8.8,18.45 9.4,19.56C7.57,18.93 6.03,17.65 5.08,16M4.26,14C4.1,13.36 4,12.69 4,12C4,11.31 4.1,10.64 4.26,10H7.64C7.56,10.66 7.5,11.32 7.5,12C7.5,12.68 7.56,13.34 7.64,14M12,4.03C12.83,5.23 13.5,6.57 13.91,8H10.09C10.5,6.57 11.17,5.23 12,4.03M18.92,8H15.97C15.65,6.75 15.19,5.55 14.59,4.44C16.43,5.07 17.96,6.34 18.92,8M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/>
                        </svg>
                    </span>
                    <span class="nav-text">Website Settings</span>
                </a>
            </nav>
        </aside>
        
        <div class="mobile-overlay" onclick="closeSidebar()"></div>
        
        <div class="main-content">
            <!-- Navbar -->
            <nav class="navbar" style="background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); padding: 1rem 0; border-bottom: 1px solid #e9ecef; position: sticky; top: 0; z-index: 1000;">
                <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 0 1rem; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <button class="menu-toggle" onclick="toggleSidebar()" style="background: none; border: none; cursor: pointer;">
                            <svg viewBox="0 0 24 24" fill="currentColor" style="width: 24px; height: 24px;">
                                <path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"/>
                            </svg>
                        </button>
                        <div onclick="openSchoolSettingsPopup()" style="cursor: pointer; display: flex; align-items: center;">
                            <img src="{% if school_info.logo %}{{ school_info.logo.url }}{% else %}{% static 'img/Everest-Crest-Square.png' %}{% endif %}" alt="{{ school_info.school_name }}" style="width: 40px; height: 40px; object-fit: contain; margin-right: 10px;">
                            <h1 style="font-size: 1.5rem; margin: 0; color: #333;">{{ school_info.school_name }}</h1>
                        </div>
                    </div>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <a href="/logout/" style="color: #dc3545; text-decoration: none; padding: 0.5rem 1rem;">Logout</a>
                    </div>
                </div>
            </nav>
            
            <main class="content">
                {% block content %}{% endblock %}
            </main>
            
            <!-- Footer -->
            <footer style="background: #f8f9fa; padding: 2rem 0; margin-top: 2rem; border-top: 1px solid #e9ecef;">
                <div style="max-width: 1200px; margin: 0 auto; padding: 0 1rem;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; text-align: center;">
                        <div>
                            <h5 style="color: #333; margin-bottom: 1rem;">{{ school_info.school_name }}</h5>
                            <p style="color: #666; margin: 0;">Excellence in Education</p>
                        </div>
                        <div>
                            <h6 style="color: #333; margin-bottom: 1rem;">Contact Info</h6>
                            <p style="color: #666; margin: 0.5rem 0;">{{ school_info.address|default:"Kathmandu, Nepal" }}</p>
                            <p style="color: #666; margin: 0.5rem 0;">Phone: {{ school_info.phone|default:"+977-1-4444444" }}</p>
                            <p style="color: #666; margin: 0.5rem 0;">Email: {{ school_info.email|default:"info@school.edu.np" }}</p>
                        </div>
                        <div>
                            <h6 style="color: #333; margin-bottom: 1rem;">Quick Links</h6>
                            <p style="margin: 0.5rem 0;"><a href="{% url 'public_registration' %}" style="color: #007bff; text-decoration: none;">Student Registration</a></p>
                            <p style="margin: 0.5rem 0;"><a href="{% url 'home' %}" style="color: #007bff; text-decoration: none;">Dashboard</a></p>
                        </div>
                    </div>
                    <hr style="margin: 2rem 0; border-color: #e9ecef;">
                    <div style="text-align: center; color: #666;">
                        <p style="margin: 0;">&copy; 2025 {{ school_info.school_name }}. All rights reserved.</p>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    
    <!-- School Settings Popup -->
    <div id="schoolSettingsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>School Settings</h2>
                <span class="close" onclick="closeSchoolSettingsPopup()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="schoolSettingsForm">
                    {% csrf_token %}
                    <div class="form-group">
                        <label>School Name</label>
                        <input type="text" name="school_name" value="{{ school_info.school_name }}" required>
                    </div>
                    <div class="form-group">
                        <label>Address</label>
                        <textarea name="address" rows="3" placeholder="Enter school address">{{ school_info.address }}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" name="phone" value="{{ school_info.phone }}" placeholder="Enter phone number">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" name="email" value="{{ school_info.email }}" placeholder="Enter email address">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Save Settings</button>
                        <button type="button" class="btn-secondary" onclick="closeSchoolSettingsPopup()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script src="{% static 'js/main.js' %}"></script>
    <script>
        function openSchoolSettingsPopup() {
            document.getElementById('schoolSettingsModal').style.display = 'flex';
        }
        
        function closeSchoolSettingsPopup() {
            document.getElementById('schoolSettingsModal').style.display = 'none';
        }
        
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }
        
        function closeSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('schoolSettingsModal');
            if (event.target == modal) {
                closeSchoolSettingsPopup();
            }
        }
        
        // Close sidebar when clicking nav items on mobile
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    closeSidebar();
                }
            });
        });
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>