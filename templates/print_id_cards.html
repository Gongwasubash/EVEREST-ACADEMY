<!DOCTYPE html>
<html>
<head>
    <title>Print ID Cards</title>
    <style>
@page {
            size: A4 landscape;
            margin: 0;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .print-container {
            display: grid;
            grid-template-columns: repeat(5, 54mm);
            grid-template-rows: repeat(2, 86mm);
            gap: 5mm;
            justify-content: center;
            align-content: center;
            page-break-after: always;
            width: 297mm;
            height: 210mm;
            margin: 0 auto;
            padding: 15mm 20mm;
            box-sizing: border-box;
        }
        
        .id-card {
            width: 54mm !important;
            height: 86mm !important;
            min-width: 54mm;
            min-height: 86mm;
            max-width: 54mm;
            max-height: 86mm;
            background: linear-gradient(180deg, #1e3c72 0%, #2a5298 30%, #667eea 100%);
            padding: 0;
            color: white;
            position: relative;
            box-shadow: 0 2mm 5mm rgba(0,0,0,0.3);
            overflow: hidden;
            border: 0.5mm solid rgba(255,255,255,0.2);
            display: flex;
            flex-direction: column;
            font-size: 7px;
            page-break-inside: avoid;
            flex-shrink: 0;
            margin: 0;
        }
        
        .card-header {
            background: rgba(255,255,255,0.15);
            padding: 2mm;
            flex-shrink: 0;
            border-bottom: 0.2mm solid rgba(255,255,255,0.2);
            display: flex;
            align-items: flex-start;
            gap: 1.5mm;
        }
        
        .school-logo {
            width: 10mm;
            height: 10mm;
            border: 0.3mm solid rgba(255,255,255,0.3);
            object-fit: cover;
            flex-shrink: 0;
        }
        
        .school-details {
            flex: 1;
        }
        
        .school-info h3 {
            margin: 0 0 0.5mm 0;
            font-size: 4.5mm;
            font-weight: 700;
            text-shadow: 0 0.2mm 0.5mm rgba(0,0,0,0.3);
            line-height: 1.1;
        }
        
        .school-info p {
            margin: 0 0 0.3mm 0;
            font-size: 2.2mm;
            opacity: 0.9;
            font-weight: 500;
            line-height: 1.2;
        }
        
        .card-body {
            padding: 2mm;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .photo-section {
            text-align: center;
            margin-bottom: 5px;
            margin-top: -5px;
        }
        
        .photo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .student-photo {
            width: 18mm;
            height: 22mm;
            object-fit: cover;
            border: 0.5mm solid rgba(255,255,255,0.4);
            box-shadow: 0 1mm 2mm rgba(0,0,0,0.3);
            display: block;
            margin: 0 auto;
        }
        
        .student-name {
            font-size: 3.2mm;
            font-weight: 700;
            margin: 3mm 0 2mm 0;
            text-shadow: 0 0.2mm 0.5mm rgba(0,0,0,0.3);
            border-bottom: 0.2mm solid rgba(255,255,255,0.3);
            padding-bottom: 1mm;
            text-align: left;
            width: 100%;
        }
        
        .details-section {
            width: 100%;
            flex: 1;
            margin-top: auto;
            margin-bottom: auto;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.3mm 0;
            border-bottom: 0.1mm solid rgba(255,255,255,0.2);
            min-height: 3mm;
        }
        
        .detail-label {
            font-size: 2mm;
            font-weight: 600;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.1mm;
            width: 45%;
        }
        
        .detail-value {
            font-size: 2.5mm;
            font-weight: 700;
            text-align: right;
            width: 55%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        

        
        @media print {
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="no-print" style="padding: 20px; text-align: center; background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
        <h2 style="color: #2c3e50; margin-bottom: 10px;">ID Cards Print Preview</h2>
        <p style="color: #6c757d; margin-bottom: 20px;">{{ students|length }} ID card(s) ready for printing</p>
        <div style="display: flex; gap: 15px; justify-content: center; align-items: center; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 8px;">
                <label for="designSelect" style="font-weight: 600;">Choose Design:</label>
                <select id="designSelect" onchange="changeDesign()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                    <option value="1">Classic Blue</option>
                    <option value="2">Red</option>
                    <option value="3">Green</option>
                    <option value="4">Yellow</option>
                    <option value="5">White</option>
                </select>
            </div>
            <button onclick="printCards()" style="padding: 12px 24px; font-size: 16px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer;">
                üñ®Ô∏è Print ID Cards
            </button>
        </div>
    </div>
    
    {% for student in students %}
        {% if forloop.counter0|divisibleby:10 %}
            {% if not forloop.first %}</div>{% endif %}
            <div class="print-container">
        {% endif %}
        <div class="id-card">
            <div class="card-header">
                {% if school.logo %}
                    <img src="{{ school.logo.url }}" alt="School Logo" class="school-logo">
                {% else %}
                    <div class="school-logo" style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px;">üè´</div>
                {% endif %}
                <div class="school-details">
                    <div class="school-info">
                        <h3>{{ school.school_name|default:"EVEREST ACADEMY" }}</h3>
                        <p>{{ school.address|default:"Kathmandu, Nepal" }}</p>
                        <p style="font-size: 1.8mm; margin: 0.3mm 0 0 0; opacity: 0.9;">Ph: {{ school.phone|default:"+977-1-4444444" }} | {{ school.email|default:"info@everestacademy.edu.np" }}</p>
                    </div>
                </div>
            </div>
            
            <div class="identity-card-header" style="text-align: center; padding: 1.5mm; background: rgba(255,255,255,0.1); border-bottom: 0.2mm solid rgba(255,255,255,0.2);">
                <div style="font-size: 2.5mm; font-weight: 700; text-transform: uppercase; letter-spacing: 0.2mm;">Student Identity Card</div>
            </div>
            
            <div class="card-body">
                <div class="photo-section">
                    <div class="photo-container">
                        <div style="position: relative; display: inline-block;">
                            {% if student.photo %}
                                <img src="{{ student.photo.url }}" alt="{{ student.name }}" class="student-photo">
                            {% else %}
                                <div class="student-photo" style="background: linear-gradient(45deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1)); display: flex; align-items: center; justify-content: center; font-size: 16px; color: rgba(255,255,255,0.7);">üì∑ PHOTO</div>
                            {% endif %}
                            {% if school.logo %}
                                <img src="{{ school.logo.url }}" style="position: absolute; bottom: -1mm; right: -1mm; width: 6mm; height: 6mm; border: 0.5mm solid rgba(255,255,255,0.9); border-radius: 50%; background: rgba(255,255,255,0.95); object-fit: cover; box-shadow: 0 1mm 3mm rgba(0,0,0,0.3); opacity: 0.85;" alt="School Seal">
                            {% endif %}
                            {% if school.principal_signature %}
                                <img src="{{ school.principal_signature.url }}" style="position: absolute; bottom: 0; left: 2mm; width: 14mm; height: 7mm; object-fit: contain; filter: brightness(0) saturate(100%) invert(13%) sepia(94%) saturate(7151%) hue-rotate(0deg) brightness(98%) contrast(118%);" alt="Principal Signature">
                            {% endif %}
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 2mm; justify-content: center;">
                            <div style="background: rgba(255,255,255,0.25); padding: 1mm 2mm; font-size: 2.2mm; font-weight: 700; text-align: center;">{{ student.reg_number }}</div>
                            <img src="https://api.qrserver.com/v1/create-qr-code/?size=80x80&data=REG NO: {{ student.reg_number }}" style="width: 12mm; height: 12mm; background: white; padding: 1mm;" alt="QR Code">
                        </div>
                    </div>
                    <div class="student-name">{{ student.name|upper }}</div>
                </div>
                
                <div class="details-section">
                    <div class="detail-row">
                        <span class="detail-label">Class & Section</span>
                        <span class="detail-value">{{ student.student_class }} - {{ student.section }}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Roll Number</span>
                        <span class="detail-value">{{ student.reg_number }}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Father's Name</span>
                        <span class="detail-value">{{ student.father_name }}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">DOB</span>
                        <span class="detail-value">{{ student.dob|date:"d/m/Y" }}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Mobile</span>
                        <span class="detail-value">{{ student.mobile }}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Address</span>
                        <span class="detail-value">{{ student.address1 }}</span>
                    </div>
                </div>
                
                <div class="validity-date" style="text-align: center; padding: 1mm; font-size: 2.6mm; font-weight: 800; opacity: 0.9; margin-top: -1mm;">
                    Valid upto <span class="valid-till-text">2082/12/30</span>
                </div>
                

            </div>
        </div>
        {% endfor %}
    </div>
    
    <script>
        const designs = {
            '1': 'linear-gradient(180deg, #1e3c72 0%, #2a5298 30%, #667eea 100%)',
            '2': 'linear-gradient(180deg, #b71c1c 0%, #d32f2f 30%, #f44336 100%)',
            '3': '#28a745',
            '4': '#ffc107',
            '5': '#ffffff'
        };
        
        function changeDesign() {
            const design = document.getElementById('designSelect').value;
            
            document.querySelectorAll('.id-card').forEach(card => {
                card.style.background = designs[design] || designs['1'];
                const identityHeader = card.querySelector('.identity-card-header');
                const validityDate = card.querySelector('.validity-date');
                if (design === '4' || design === '5') {
                    card.style.color = '#1e3c72';
                    card.style.borderColor = '#1e3c72';
                    if (design === '5') {
                        if (identityHeader) {
                            identityHeader.style.background = '#1e3c72';
                            identityHeader.style.color = 'white';
                            identityHeader.style.borderBottom = '0.2mm solid #1e3c72';
                        }
                        if (validityDate) {
                            validityDate.style.background = '#1e3c72';
                            validityDate.style.color = 'white';
                        }
                    }
                } else {
                    card.style.color = 'white';
                    card.style.borderColor = 'rgba(255,255,255,0.2)';
                    if (identityHeader) {
                        identityHeader.style.background = 'rgba(255,255,255,0.1)';
                        identityHeader.style.color = 'white';
                        identityHeader.style.borderBottom = '0.2mm solid rgba(255,255,255,0.2)';
                    }
                    if (validityDate) {
                        validityDate.style.background = 'transparent';
                        validityDate.style.color = 'white';
                    }
                }
            });
        }
        
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const template = urlParams.get('template') || '1';
            document.getElementById('designSelect').value = template;
            changeDesign();
            
            // Update valid till date
            const validTill = urlParams.get('valid_till') || localStorage.getItem('validTillDate') || '2082/12/30';
            document.querySelectorAll('.valid-till-text').forEach(element => {
                element.textContent = validTill;
            });
        };
        

        
        function printCards() {
            window.print();
        }
        

    </script>
</body>
</html>