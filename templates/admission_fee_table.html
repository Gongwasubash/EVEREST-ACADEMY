{% extends "base.html" %}

{% block title %}Admission Fee Table - School Management{% endblock %}

{% block content %}
<div class="admission-fee-container">
    <div class="page-header">
        <h1>Admission Fee Table</h1>
        <div class="header-actions">
            <input type="text" id="searchInput" placeholder="Search students..." class="search-input">
        </div>
    </div>

    <div class="table-container">
        <table class="table table-striped" id="admissionTable">
            <thead>
                <tr>
                    <th>S.No</th>
                    <th>Student ID</th>
                    <th>Name</th>
                    <th>Class</th>
                    <th>Section</th>
                    <th>Admission Fee</th>
                    <th>Status</th>
                    <th>Paid Months</th>
                    <th>Payment Date</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for student in students %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>STU{{ student.id|stringformat:"03d" }}</td>
                    <td>{{ student.name }}</td>
                    <td>{{ student.student_class }}</td>
                    <td>{{ student.section }}</td>
                    <td>Rs {{ student.admission_fee|default:"0" }}</td>
                    <td>
                        {% if student.admission_paid or student.has_monthly_payment %}
                            <span class="status-badge paid">PAID</span>
                        {% else %}
                            <span class="status-badge unpaid">UNPAID</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="months-paid">
                            <div class="month-checkboxes">
                                <label class="month-checkbox"><input type="checkbox" disabled {% if 'Baisakh' in student.paid_months %}checked{% endif %}> B</label>
                                <label class="month-checkbox"><input type="checkbox" disabled {% if 'Jestha' in student.paid_months %}checked{% endif %}> J</label>
                                <label class="month-checkbox"><input type="checkbox" disabled {% if 'Ashadh' in student.paid_months %}checked{% endif %}> A</label>
                                <label class="month-checkbox"><input type="checkbox" disabled {% if 'Shrawan' in student.paid_months %}checked{% endif %}> S</label>
                                <label class="month-checkbox"><input type="checkbox" disabled {% if 'Bhadra' in student.paid_months %}checked{% endif %}> B</label>
                                <label class="month-checkbox"><input type="checkbox" disabled {% if 'Ashwin' in student.paid_months %}checked{% endif %}> A</label>
                                <label class="month-checkbox"><input type="checkbox" disabled {% if 'Kartik' in student.paid_months %}checked{% endif %}> K</label>
                                <label class="month-checkbox"><input type="checkbox" disabled {% if 'Mangsir' in student.paid_months %}checked{% endif %}> M</label>
                                <label class="month-checkbox"><input type="checkbox" disabled {% if 'Poush' in student.paid_months %}checked{% endif %}> P</label>
                                <label class="month-checkbox"><input type="checkbox" disabled {% if 'Magh' in student.paid_months %}checked{% endif %}> M</label>
                                <label class="month-checkbox"><input type="checkbox" disabled {% if 'Falgun' in student.paid_months %}checked{% endif %}> F</label>
                                <label class="month-checkbox"><input type="checkbox" disabled {% if 'Chaitra' in student.paid_months %}checked{% endif %}> C</label>
                            </div>
                        </div>
                    </td>
                    <td>{{ student.admission_payment_date|default:"-" }}</td>
                    <td>
                        {% if not student.admission_paid %}
                            <button class="action-btn pay-btn" onclick="payAdmission({{ student.id }})" title="Pay Admission">Pay</button>
                        {% endif %}
                        <button class="action-btn view-btn" onclick="viewStudent({{ student.id }})" title="View">View</button>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="10" style="text-align: center; padding: 20px;">No students found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.admission-fee-container {
    padding: 20px;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #e2e8f0;
}

.search-input {
    padding: 8px 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    width: 250px;
    font-size: 14px;
}

.table-container {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    overflow-x: auto;
}

.table {
    margin: 0;
    font-size: 14px;
    width: 100%;
}

.table th {
    background: #f8fafc;
    padding: 12px 8px;
    text-align: left;
}

.table td {
    padding: 10px 8px;
    vertical-align: middle;
}

.status-badge {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: bold;
    text-transform: uppercase;
}

.status-badge.paid {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.status-badge.unpaid {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.action-btn {
    padding: 4px 8px;
    margin: 0 2px;
    border: none;
    border-radius: 3px;
    font-size: 11px;
    font-weight: bold;
    cursor: pointer;
    min-width: 30px;
}

.pay-btn { background: #28a745; color: white; }
.view-btn { background: #3182ce; color: white; }

.action-btn:hover {
    opacity: 0.8;
    transform: translateY(-1px);
}

.months-paid {
    padding: 5px;
}

.month-checkboxes {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 3px;
    max-width: 200px;
}

.month-checkbox {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: bold;
    cursor: default;
    padding: 2px;
    border-radius: 3px;
    background: #f8f9fa;
    border: 1px solid #e9ecef;
}

.month-checkbox input[type="checkbox"] {
    width: 12px;
    height: 12px;
    margin: 0 2px 0 0;
    cursor: default;
}

.month-checkbox input[type="checkbox"]:checked {
    background: #28a745;
    border-color: #28a745;
}

.month-checkbox:has(input:checked) {
    background: #d4edda;
    border-color: #28a745;
    color: #155724;
    font-weight: bold;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Search functionality
document.getElementById('searchInput').addEventListener('keyup', function() {
    const searchTerm = this.value.toLowerCase();
    const table = document.getElementById('admissionTable');
    const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
    
    for (let i = 0; i < rows.length; i++) {
        const row = rows[i];
        const cells = row.getElementsByTagName('td');
        let found = false;
        
        for (let j = 0; j < cells.length - 1; j++) {
            if (cells[j].textContent.toLowerCase().includes(searchTerm)) {
                found = true;
                break;
            }
        }
        
        row.style.display = found ? '' : 'none';
    }
});

function payAdmission(studentId) {
    window.location.href = `/pay-student/${studentId}/`;
}

function viewStudent(studentId) {
    alert(`Viewing student with ID: ${studentId}`);
}
</script>
{% endblock %}